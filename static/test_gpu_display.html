<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPU信息测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .gpu-card { border: 1px solid #ddd; padding: 10px; margin: 10px; border-radius: 5px; }
        .badge { display: inline-block; padding: 3px 8px; margin: 0 3px; border-radius: 12px; font-size: 12px; }
        .bg-success { background-color: #28a745; color: white; }
        .bg-secondary { background-color: #6c757d; color: white; }
    </style>
</head>
<body>
    <h1>GPU信息测试</h1>
    <div id="gpuContainer"></div>

    <script>
        // 获取GPU信息并显示
        async function fetchAndDisplayGPUInfo() {
            try {
                const response = await fetch('/gpu_info');
                const gpuInfo = await response.json();
                const container = document.getElementById('gpuContainer');
                
                if (gpuInfo.success && gpuInfo.gpus && gpuInfo.gpus.length > 0) {
                    container.innerHTML = '';
                    
                    gpuInfo.gpus.forEach(gpu => {
                        const gpuCard = document.createElement('div');
                        gpuCard.className = 'gpu-card';
                        
                        // 计算利用率百分比
                        const gpuUtilization = gpu.utilization && gpu.utilization.gpu !== undefined ? gpu.utilization.gpu : null;
                        const utilizationPercent = gpuUtilization !== null ? (gpuUtilization * 100).toFixed(1) : '数据不可用';
                        const gpuUtilizationRate = gpuUtilization !== null ? gpuUtilization.toFixed(1) : '数据不可用';
                        
                        // 设置GPU信息
                        gpuCard.innerHTML = `
                            <h3>GPU ${gpu.id}</h3>
                            <p>名称: ${gpu.name}</p>
                            <p>总内存: ${gpu.total_memory.toFixed(1)}GB</p>
                            <p>已分配内存: ${gpu.allocated_memory.toFixed(1)}GB</p>
                            <p>可用内存: ${gpu.available_memory.toFixed(1)}GB</p>
                            <p>温度: ${gpu.temperature !== undefined ? gpu.temperature + '°C' : '数据不可用'}</p>
                            <p>利用率: <span class="badge ${gpuUtilization !== null ? 'bg-success' : 'bg-secondary'}">${gpuUtilizationRate}%</span></p>
                            <p>利用率百分比: ${utilizationPercent}%</p>
                            <p>原始数据: ${JSON.stringify(gpu.utilization)}</p>
                        `;
                        
                        container.appendChild(gpuCard);
                    });
                } else {
                    container.innerHTML = '<p>未获取到GPU信息或API调用失败</p>';
                    console.error('GPU信息获取失败:', gpuInfo.error);
                }
            } catch (error) {
                console.error('获取GPU信息时出错:', error);
                document.getElementById('gpuContainer').innerHTML = `<p>获取GPU信息时出错: ${error.message}</p>`;
            }
        }

        // 页面加载时获取GPU信息
        window.onload = fetchAndDisplayGPUInfo;
    </script>
</body>
</html>