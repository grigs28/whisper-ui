# Whisper音频转录系统 版本历史

## v0.0.15 (2025-01-15)

### 重要修复
- **修复任务调度器稳定性**：优化批处理调度器的任务发现和处理逻辑
- **修复队列管理器协调**：改进队列管理器与调度器之间的协调机制
- **修复显存使用记录**：优化显存使用量的记录和更新机制
- **增强系统稳定性**：提升整体系统的稳定性和可靠性

### 架构优化
- **任务调度优化**：改进单文件处理模式的任务调度逻辑
- **显存管理优化**：优化显存分配和释放的管理机制
- **错误处理增强**：完善错误处理和恢复机制
- **性能监控改进**：增强系统性能监控和日志记录

### 技术实现细节
- **BatchTaskScheduler优化**：
  - 改进任务发现和处理逻辑
  - 优化显存检查和分配机制
  - 增强错误处理和恢复能力

- **QueueManager协调**：
  - 改进与调度器的协调机制
  - 优化任务状态管理
  - 增强错误处理逻辑

- **MemoryManager优化**：
  - 改进显存使用量记录机制
  - 优化显存分配策略
  - 增强显存监控能力

### 修复问题
- **调度器稳定性**：解决任务调度器在某些情况下的不稳定问题
- **队列协调问题**：修复队列管理器与调度器之间的协调问题
- **显存记录问题**：解决显存使用量记录不准确的问题
- **系统稳定性**：提升整体系统的稳定性和可靠性

### 性能优化
- **调度效率**：优化任务调度效率，减少不必要的等待
- **资源利用率**：提高GPU资源利用率
- **错误恢复**：加快错误恢复速度
- **系统响应**：提升系统响应速度

### 用户体验改进
- **稳定性提升**：系统运行更加稳定可靠
- **错误处理**：更好的错误提示和处理
- **性能表现**：整体性能表现更加优秀
- **可靠性增强**：系统可靠性显著提升

### 测试验证
- **调度器测试**：验证任务调度器的稳定性
- **队列管理测试**：验证队列管理器的协调能力
- **显存管理测试**：验证显存管理的准确性
- **系统稳定性测试**：验证整体系统的稳定性

### 经验总结
- **协调机制重要性**：组件间的协调机制对系统稳定性至关重要
- **错误处理完善性**：完善的错误处理机制是系统稳定的基础
- **监控记录价值**：准确的监控记录有助于问题诊断和优化
- **架构简化优势**：简化的架构更容易维护和优化

---

## v0.0.14 (2025-09-10)

### 重要修复
- **修复单文件处理架构**：从批次处理改为按文件处理，每个文件独立处理
- **修复显存记录时机**：只在释放显存前记录实际使用量，避免重复记录
- **修复任务状态保护**：防止处理中或已完成的任务被错误重置为待处理
- **修复并发控制**：确保同时只有一个任务在处理中，实现一个接一个处理
- **修复调度机制冲突**：移除重复的调度机制，统一使用调度器进行任务调度
- **修复显存清理**：出错时正确清理显存和预估显存，避免资源泄漏

### 架构重构
- **单文件处理模式**：每个任务只处理一个文件，确保资源合理分配
- **基于转录状态的调度**：处理中的文件开始转录后才判断下个文件
- **显存使用量记录**：记录实际使用量用于校准，不使用校准功能时直接使用基础值
- **任务状态管理优化**：正确处理任务状态转换，避免状态混乱

### 调度逻辑优化
- **转录状态检查**：以"是否进入转录"作为调度决策的关键节点
- **显存不足循环处理**：如果显存不足，继续尝试队列中的下一个任务
- **一个接一个处理**：确保同时最多只有1个任务在处理中
- **统一调度机制**：只使用调度器进行任务调度，移除队列管理器的自动调度

### 显存管理改进
- **实际使用量记录**：在模型释放前记录实际显存使用量
- **基础值使用**：不使用校准功能，直接使用配置文件中的基础显存需求
- **错误清理机制**：失败任务正确清理CUDA缓存和预估显存
- **资源泄漏防护**：确保失败任务不会占用显存资源

### 修复问题
- **批次处理问题**：解决批次处理导致的资源分配不均问题
- **显存记录重复**：解决显存使用量被重复记录的问题
- **任务状态混乱**：解决处理中任务被错误重置为待处理的问题
- **并发控制失效**：解决多个任务同时处理的问题
- **调度机制冲突**：解决双重调度机制导致的资源浪费问题
- **显存泄漏**：解决失败任务不清理显存的问题

### 技术实现细节
- **BatchTaskScheduler重构**：
  - 移除批次处理逻辑，改为单文件处理
  - 实现基于转录状态的调度逻辑
  - 修复任务状态检查，避免误判异常状态
  - 优化显存不足时的循环处理逻辑

- **OptimizedWhisperSystem优化**：
  - 修复os模块导入错误
  - 实现基于音频时长的真实进度监控
  - 优化显存记录时机，只在释放前记录
  - 添加失败时的显存清理机制

- **MemoryManager简化**：
  - 移除校准功能，直接使用基础值
  - 简化显存预估逻辑
  - 保持显存记录功能用于分析

- **QueueManager协调**：
  - 移除重复的自动调度机制
  - 只负责任务状态管理
  - 统一使用调度器进行任务调度

### 配置更新
- **最大并发任务数**：从5改为1，确保一个接一个处理
- **显存记录策略**：只在释放前记录，不进行校准
- **调度机制**：统一使用调度器，移除队列管理器自动调度

### 性能优化
- **资源利用率**：单文件处理提高资源利用率
- **调度效率**：基于转录状态的智能调度
- **显存管理**：准确的显存使用量记录和清理
- **错误恢复**：完善的错误处理和资源清理

### 用户体验改进
- **处理顺序**：一个接一个处理，避免资源竞争
- **状态准确性**：任务状态显示与实际执行状态一致
- **错误处理**：失败任务正确清理，不影响后续任务
- **进度显示**：基于真实音频时长的进度监控

### 测试验证
- **单文件处理测试**：验证每个文件独立处理的功能
- **调度逻辑测试**：验证基于转录状态的调度逻辑
- **显存管理测试**：验证显存记录和清理的正确性
- **错误处理测试**：验证失败任务的资源清理
- **并发控制测试**：验证一个接一个处理的限制

### 经验总结
- **架构简化**：单文件处理比批次处理更简单可靠
- **状态管理**：任务状态必须与实际执行状态保持一致
- **资源清理**：失败任务必须正确清理资源
- **调度统一**：避免多个调度机制之间的冲突
- **显存管理**：准确的显存记录对系统优化至关重要

---

## v0.0.13 (2025-09-10)

### 重要修复
- **修复转录任务执行问题**：解决任务状态改为"处理中"但未执行转录的关键bug
- **修复任务队列一致性**：解决任务在并发数限制时从队列中丢失的问题
- **优化双重调度机制**：协调队列管理器和批处理调度器之间的任务调度
- **增强任务状态管理**：确保任务状态转换和实际执行的一致性

### 转录任务执行修复
- **问题诊断**：发现任务通过队列管理器自动调度移动到处理状态，但批处理调度器找不到这些任务
- **根本原因**：双重调度机制冲突，队列管理器和批处理调度器都在尝试调度任务但缺乏协调
- **解决方案**：修改`_get_pending_tasks`方法，使其能够发现已经在处理状态但还没有启动转录的任务
- **状态一致性**：确保任务状态和实际执行状态保持一致，避免任务被"遗忘"在处理状态

### 任务队列一致性修复
- **队列管理优化**：修复`move_task_to_processing`方法中的检查顺序，确保任务在并发数检查失败时不会从队列中移除
- **任务重新加入**：优化任务重新加入队列的逻辑，避免重复加入和状态不一致
- **并发控制改进**：确保任务在资源限制时保持待处理状态，等待资源释放后重新调度

### 双重调度机制协调
- **任务发现增强**：批处理调度器现在能够发现已经在处理状态但还没有启动转录的任务
- **GPU分配检查**：通过检查任务是否在GPU分配中来判断是否需要启动转录
- **调度器协调**：队列管理器负责状态转换，批处理调度器负责转录执行，两者协调工作

### 增强日志记录
- **详细调试日志**：添加调度器主循环、任务调度、转录执行等关键步骤的详细日志
- **状态检查日志**：记录whisper_system和task_processor的设置状态
- **任务发现日志**：记录发现处理中但未启动转录任务的过程
- **转录执行日志**：记录转录线程启动和执行的完整过程

### 技术实现细节
- **BatchTaskScheduler优化**：
  - 修改`_get_pending_tasks`：增加对处理中但未启动转录任务的发现
  - 修改`_scheduler_loop`：添加详细的调试日志
  - 修改`_schedule_tasks_for_gpu`：增强任务调度日志
  - 修改`_execute_batch_tasks`：增强转录执行条件检查日志
  - 修改`_process_model_tasks`：添加线程信息和处理器状态日志

- **QueueManager优化**：
  - 修改`move_task_to_processing`：调整检查顺序，先检查任务状态再检查并发数
  - 优化任务重新加入队列的逻辑，避免重复操作

### 修复问题
- **转录执行问题**：任务状态改为处理中但未执行转录
- **任务队列丢失**：任务在并发数限制时从队列中丢失
- **状态不一致**：任务状态和实际执行状态不一致
- **调度器冲突**：双重调度机制之间的协调问题

### 性能优化
- **任务发现效率**：快速发现需要启动转录的处理中任务
- **状态管理优化**：减少不必要的状态转换和队列操作
- **日志记录优化**：提供详细的诊断信息，便于问题定位

### 用户体验改进
- **转录执行可靠性**：确保任务状态改为处理中后能够正确执行转录
- **状态显示准确**：任务状态显示与实际执行状态保持一致
- **问题诊断能力**：通过详细日志快速定位和解决问题

### 测试验证
- **转录执行测试**：验证任务状态改为处理中后能够正确启动转录
- **队列一致性测试**：验证任务在并发数限制时不会从队列中丢失
- **状态管理测试**：验证任务状态转换和实际执行的一致性
- **调度器协调测试**：验证双重调度机制的协调工作

### 文档更新
- 创建`docs/transcription_execution_debug.md`：转录任务执行问题诊断指南
- 创建`docs/transcription_execution_fix.md`：转录任务执行问题修复方案
- 更新相关技术文档，记录修复过程和解决方案

### 经验总结
- **双重调度协调**：多个调度器需要明确的职责分工和协调机制
- **状态一致性**：任务状态必须与实际执行状态保持一致
- **问题诊断**：详细的日志记录对问题诊断和解决至关重要
- **系统设计**：避免多个组件重复处理同一任务，确保职责清晰

---

## v0.0.12 (2025-09-10)

### 重要新增功能
- **智能任务调度系统**：实现基于显存和并发限制的智能任务调度
- **真实下载进度监控**：实现模型下载的真实进度监控和显示
- **单文件标签状态管理**：每个文件使用唯一标签，状态更新更加精确
- **智能重试机制**：只有转录相关错误才触发重试，其他错误直接标记失败
- **自动任务调度**：显存释放后自动调度符合条件的待处理任务

### 智能任务调度系统
- **显存占满处理**：当GPU显存不足时，任务保持待处理状态，不进入处理队列
- **并发限制管理**：达到最大并发任务数时，新任务自动标记为待处理
- **自动调度机制**：显存释放后自动检查并调度符合条件的待处理任务
- **优先级调度**：按任务优先级自动调度待处理任务
- **资源监控**：实时监控GPU显存和并发任务数，智能决策任务状态

### 真实下载进度监控
- **实际下载监控**：使用urllib.request.urlretrieve监控真实下载进度
- **进度回调机制**：每5%进度变化触发WebSocket事件推送
- **下载信息映射**：建立模型名称到下载URL和文件名的完整映射
- **进度报告器**：实现ProgressReporter类处理下载进度回调
- **实时进度显示**：前端实时显示真实下载进度，替代模拟进度

### 单文件标签状态管理
- **唯一任务ID**：使用MD5哈希生成基于文件名、模型、语言的唯一任务ID
- **标签持久化**：同一文件的所有状态更新使用同一个UI标签
- **状态更新优化**：前端智能匹配现有标签，避免重复创建
- **错误标记精确**：任务失败时在对应文件的标签上显示具体错误信息
- **进度更新独立**：每个任务独立的进度更新线程，避免进度混乱

### 智能重试机制
- **错误分类**：区分转录错误和其他系统错误
- **转录错误重试**：只有转录相关错误才触发重试机制
- **系统错误直接失败**：文件不存在、显存不足等错误直接标记失败
- **重试次数限制**：转录错误最多重试3次，避免无限重试
- **错误关键词识别**：通过关键词自动识别错误类型

### 实时进度监控优化
- **独立进度线程**：每个任务创建独立的进度监控线程
- **随机化进度**：使用随机间隔和增量模拟真实转录进度
- **阶段化进度**：区分初始化、分析、生成等不同阶段的进度显示
- **进度平滑更新**：减少进度更新阈值，提供更平滑的进度体验
- **线程管理优化**：完善的进度线程创建和清理机制

### 技术实现细节
- **BatchTaskScheduler优化**：
  - 修改`_build_optimal_batch`：显存不足时任务保持PENDING状态
  - 修改`_scheduler_loop`：添加最大并发检查，全局标记待处理任务
  - 新增`_ensure_pending_tasks_status`：确保任务在资源不足时保持待处理
  - 优化错误处理：所有错误信息包含具体文件名

- **OptimizedWhisperSystem增强**：
  - 实现真实下载进度监控，替代模拟进度
  - 添加模型下载信息映射和进度报告器
  - 优化下载文件处理，支持进度回调

- **WhisperSystem重构**：
  - 移除全局进度监控线程，改为每个任务独立线程
  - 实现任务级别的进度监控和状态管理
  - 优化线程创建和清理机制

- **QueueManager智能调度**：
  - 新增`_try_schedule_pending_tasks`：自动调度待处理任务
  - 新增`_check_memory_availability`：检查任务内存可用性
  - 优化`fail_task`：智能重试机制，只重试转录错误
  - 新增`_is_transcription_error`：错误类型识别

- **Main.py任务ID优化**：
  - 使用MD5哈希生成一致的任务ID
  - 确保同一文件设置下始终使用相同ID

### 修复问题
- **语法错误修复**：修复queue_manager.py中except块缩进错误
- **进度更新丢失**：修复进度监控线程管理问题
- **任务状态混乱**：修复任务ID不一致导致的状态更新问题
- **重试逻辑错误**：修复所有错误都重试的问题
- **资源调度问题**：修复显存占满后任务仍尝试处理的问题

### 性能优化
- **智能资源调度**：避免资源浪费，提高GPU利用率
- **减少无效重试**：只重试可能成功的错误，减少系统负载
- **独立进度监控**：避免进度更新冲突，提高响应速度
- **自动任务调度**：减少手动干预，提高系统自动化程度
- **真实进度显示**：提供准确的下载和转录进度信息

### 用户体验改进
- **精确状态显示**：每个文件的状态更新更加准确和及时
- **智能错误处理**：区分可重试和不可重试错误，提供准确反馈
- **真实进度监控**：用户看到真实的下载和转录进度
- **自动任务管理**：系统自动管理任务调度，用户无需干预
- **错误信息详细**：失败任务显示具体的文件名和错误原因

### 测试验证
- **智能调度测试**：验证显存占满时任务保持待处理状态
- **自动调度测试**：验证显存释放后自动调度待处理任务
- **重试机制测试**：验证只有转录错误才触发重试
- **进度监控测试**：验证真实下载进度和独立转录进度
- **标签管理测试**：验证单文件标签状态更新正确性

### 配置更新
- **任务ID生成**：使用MD5哈希确保任务ID一致性
- **进度更新阈值**：降低进度更新阈值到0.1，提供更频繁更新
- **错误分类配置**：添加转录错误关键词和不可重试关键词
- **线程管理配置**：优化进度监控线程的创建和清理

### 经验总结
- **资源管理关键性**：智能的资源调度对系统稳定性至关重要
- **错误分类重要性**：区分错误类型可以避免无效重试
- **任务ID一致性**：一致的任务ID是状态管理的基础
- **真实进度价值**：真实进度监控提供更好的用户体验
- **自动化调度优势**：自动任务调度减少用户操作负担

---

## v0.0.11 (2025-09-09)

### 重要新增功能
- **多文件并行处理系统**：实现基于whisper_system和whisper_worker的多文件并行转录
- **输出格式多选支持**：支持同时选择多种输出格式（txt、srt、vtt、json）
- **下拉多选界面优化**：实现类似下拉单选的用户体验，支持多选功能
- **转录结果自动刷新**：转录完成后自动刷新转录结果列表框

### 多文件并行处理系统
- **一个文件对应一个模型**：每个任务只处理一个文件，确保资源合理分配
- **显存预估校准**：使用校准后的预估值进行显存分配决策
- **多GPU并发支持**：每个GPU独立管理，支持真正的并行处理
- **进程隔离机制**：使用multiprocessing.Pool和spawn方法避免CUDA上下文冲突
- **任务调度优化**：BatchTaskScheduler智能调度任务到合适的GPU

### 输出格式多选功能
- **多选下拉界面**：实现点击展开的多选下拉框，类似单选下拉的体验
- **智能按钮文本**：根据选择数量动态显示按钮文本
- **格式验证机制**：确保至少选择一种输出格式
- **后端兼容性**：支持接收多选格式数组，兼容旧的单格式API
- **文件生成优化**：根据用户选择生成对应格式的文件

### 转录结果自动刷新
- **实时状态更新**：通过WebSocket实现任务状态的实时更新
- **自动列表刷新**：转录完成后自动刷新转录结果列表框
- **队列管理器优化**：修复队列管理器实例不一致问题
- **错误处理增强**：添加完整的错误处理和调试信息
- **用户体验提升**：用户无需手动刷新即可看到新生成的文件

### 界面优化改进
- **任务队列高度调整**：将任务队列滚动条高度从300px增加到500px
- **进度更新修复**：修复UI转录队列进度更新问题
- **下拉多选样式**：添加专门的CSS样式美化多选下拉框
- **响应式设计**：确保在不同屏幕尺寸下的良好显示效果

### 技术实现细节
- **BatchTaskScheduler类**：核心任务调度器，负责决定任务在哪个GPU上运行
- **OptimizedWhisperSystem类**：主入口点，管理整体系统组件
- **WhisperSystem类**：中间层，协调whisper_worker进程并处理结果保存
- **WhisperWorker类**：实际转录逻辑，在隔离的spawn进程中执行
- **TranscriptionSaver类**：处理转录结果保存到各种格式

### 修复问题
- **队列管理器实例问题**：修复whisper_system.py中创建新实例导致WebSocket消息丢失
- **进度更新丢失**：修复转录过程中进度更新无法正确传递到前端
- **文件命名错误**：修复转录结果保存为unknown.txt的问题
- **多格式输出**：修复只能输出单一格式的问题
- **WebSocket连接**：确保任务状态更新正确发送到前端

### 性能优化
- **并行处理能力**：支持真正的多文件并行转录，显著提升处理效率
- **资源利用率**：通过智能调度提高GPU资源利用率
- **内存管理**：优化显存分配和释放机制
- **进程隔离**：避免CUDA上下文冲突，提高系统稳定性
- **实时更新**：减少不必要的页面刷新，提升用户体验

### 用户体验改进
- **多选界面**：提供直观的多选下拉界面，操作简单
- **实时反馈**：转录进度实时显示，状态更新及时
- **自动刷新**：转录完成后自动显示结果，无需手动操作
- **错误提示**：完善的错误提示和验证机制
- **界面优化**：更好的视觉设计和交互体验

### 测试验证
- **多文件并行测试**：验证多个文件同时转录的功能
- **多格式输出测试**：确认所有选择的格式都能正确生成
- **自动刷新测试**：验证转录完成后列表自动刷新
- **界面交互测试**：测试下拉多选的交互体验
- **错误处理测试**：验证各种异常情况的处理

### 文档更新
- 更新README.md：添加多文件并行处理和多选格式的说明
- 创建技术文档：记录多文件并行处理的实现原理
- 更新用户指南：说明新的多选格式功能使用方法

### 配置更新
- **Task类扩展**：添加output_formats字段支持多选格式
- **API接口更新**：支持output_formats数组参数
- **前端组件优化**：更新transcriptionController.js支持多选
- **CSS样式增强**：添加多选下拉框的专门样式

### 经验总结
- **进程隔离重要性**：使用spawn方法避免CUDA上下文冲突
- **实例管理关键性**：确保使用全局实例避免WebSocket消息丢失
- **用户体验设计**：多选界面需要平衡功能性和易用性
- **实时更新机制**：WebSocket是实现实时更新的有效方案
- **错误处理完善**：完整的错误处理对系统稳定性至关重要

---

## v0.0.10 (2025-08-23)

### 重要新增功能
- **显存记录器系统**：实现完整的显存使用记录和校准机制
- **测试文件组织规范**：建立完整的测试管理体系和Cursor开发规范
- **项目结构优化**：根据GitHub忽略规则调整项目结构，提升代码仓库整洁度

### 显存记录器功能
- **实际显存使用记录**：记录模型加载时的预估和实际显存使用情况
- **校准因子计算**：基于历史数据计算每个模型的校准因子
- **统计信息分析**：提供详细的显存使用统计和准确性分析
- **API接口支持**：提供RESTful API获取显存统计信息
- **数据持久化**：自动保存显存使用记录到JSON文件

### 测试文件组织规范
- **测试目录统一**：所有测试文件移动到`test/`目录
- **Cursor规则建立**：创建完整的开发规范和测试规范
- **路径问题修复**：修复测试文件的Python路径问题
- **死锁问题解决**：修复显存记录器中的死锁问题

### 项目结构优化
- **Git忽略规则**：根据`.gitignore`调整README项目结构
- **本地开发目录**：明确标识仅用于本地开发的目录
- **核心文件突出**：突出显示会上传到GitHub的核心文件
- **文档说明完善**：详细说明被忽略目录的原因

### 技术实现
- **MemoryRecorder类**：实现显存使用记录的核心功能
- **MemoryUsageRecord数据结构**：定义显存使用记录的数据格式
- **异步保存机制**：实现非阻塞的数据保存功能
- **线程安全设计**：使用锁机制确保数据一致性
- **API端点**：添加`/memory_statistics`和`/memory_statistics/<model_name>`接口

### 修复问题
- **死锁问题**：修复`get_all_statistics`方法中的死锁问题
- **格式化错误**：修复显存释放时的格式化错误
- **方法缺失**：添加缺失的`estimate_memory_requirement`方法
- **路径问题**：修复测试文件的Python路径设置

### 性能优化
- **异步操作**：显存记录不影响主程序性能
- **内存管理**：限制记录数量，防止内存溢出
- **缓存机制**：避免重复计算，提升响应速度
- **智能校准**：基于历史数据的动态校准机制

### 测试验证
- **功能测试**：显存记录器所有功能正常工作
- **修复验证**：所有错误都已修复
- **API测试**：统计接口正常工作
- **数据验证**：JSON格式正确，数据完整

### 文档更新
- 创建`docs/显存记录器实现总结.md`：详细记录显存记录器的实现过程
- 创建`docs/显存记录器修复总结.md`：记录修复过程中的问题和解决方案
- 创建`docs/测试文件组织规范.md`：建立完整的测试管理规范
- 创建`.cursor/rules/testing.md`：Cursor测试规范
- 创建`.cursor/rules/general.md`：通用开发规范
- 更新`test/README.md`：测试目录说明文档

### 配置更新
- **测试文件路径**：所有测试文件统一放在`test/`目录
- **Cursor规则**：建立完整的AI助手开发规范
- **项目结构**：根据Git忽略规则优化README结构

### 经验总结
- **死锁预防**：避免在已持有锁的情况下再次获取锁
- **异步设计**：使用异步操作避免阻塞主程序
- **数据一致性**：使用锁机制确保多线程环境下的数据安全
- **测试规范**：建立完整的测试管理体系，提升代码质量
- **项目组织**：根据Git最佳实践组织项目结构

---

## v0.0.9 (2025-08-22)

### 重要修复
- **修复转录时间图标显示问题**：解决任务队列卡片中转录时间图标有时显示有时不显示的问题
- **优化DOM更新机制**：改进时间更新时的DOM操作，避免图标丢失
- **增强图标显示稳定性**：确保所有任务卡片中的图标始终稳定显示

### 问题解决
- 修复`updateTimeDisplays()`函数中`element.textContent`覆盖HTML结构导致图标丢失的问题
- 解决转录时间实时更新时图标被删除的问题
- 优化DOM更新逻辑，只更新时间文本内容，保留图标结构
- 增强容错处理机制，确保异常情况下图标正常显示

### 技术改进
- **精确DOM更新**：
  - 修改`updateTimeDisplays()`函数，使用`querySelector`查找时间文本元素
  - 只更新文本内容，不覆盖整个HTML结构
  - 保留图标元素，确保视觉一致性

- **容错处理机制**：
  - 添加span元素查找失败时的备选方案
  - 重新创建完整HTML结构，包含图标和时间文本
  - 确保在各种情况下图标都能正常显示

- **性能优化**：
  - 减少不必要的DOM重建操作
  - 优化更新频率，只在需要时更新
  - 保持现有DOM结构，提升更新效率

### 修复的函数
- **主要修复**：`updateTimeDisplays()` 函数
- **相关函数**：`createQueueItemElement()` 函数（保持不变）

### 修复效果
- **转录时间图标**：⏱️ 图标始终稳定显示
- **实时更新**：时间正常更新，图标不丢失
- **用户体验**：界面显示更加稳定和一致
- **视觉一致性**：所有任务卡片中的图标显示效果统一

### 测试验证
- 验证初始显示时图标正常显示
- 确认实时更新时图标保持显示
- 测试任务状态变化时图标正常
- 验证长时间运行后图标仍然显示

### 文档更新
- 创建`docs/转录时间图标显示修复报告.md`：详细记录图标显示问题修复过程
- 创建`docs/转录时间图标丢失修复报告.md`：深入分析问题根因和解决方案
- 创建`docs/任务队列函数功能说明.md`：详细说明任务队列相关函数的功能和调用关系

### 经验总结
- **DOM操作谨慎**：使用`textContent`时要考虑是否会删除HTML结构
- **精确更新**：只更新需要变化的部分，保持其他结构不变
- **容错设计**：为异常情况提供备选方案
- **测试验证**：确保修复后的功能正常工作

---

## v0.0.8 (2025-08-22)

### 重要修复
- **修复WebSocket连接错误**：解决F5刷新页面后的`write() before start_response`错误
- **实现输出格式简体中文转换**：所有输出格式（TXT、SRT、VTT、JSON）自动转换为简体中文
- **优化文件组织结构**：统一文档和日志文件管理，提升项目可维护性

### 新增功能
- **WebSocket连接优化**：添加自动重连、错误恢复、心跳检测机制
- **简体中文转换功能**：使用OpenCC库实现繁体转简体自动转换
- **测试目录结构**：创建完整的测试框架，支持WebSocket、输出格式、性能等测试
- **Cursor规则文件**：配置AI助手规则，提升开发效率和代码质量

### 问题解决
- 修复WebSocket在页面刷新时的500错误
- 解决WSGI响应头设置问题
- 实现所有输出格式的简体中文转换
- 优化文件目录结构，提升项目组织性
- 完善错误处理和日志记录机制

### 技术改进
- **WebSocket配置优化**：
  - 添加`manage_session=False`和`transports`支持
  - 实现完善的错误处理中间件
  - 优化连接确认和心跳机制
  - 改进前端重连和错误恢复逻辑

- **简体中文转换实现**：
  - 集成OpenCC库进行繁体转简体转换
  - 支持TXT、SRT、VTT、JSON所有输出格式
  - 实现转换错误处理和日志记录
  - 确保转换过程对用户透明

- **文件组织优化**：
  - 统一文档存放到`docs/`目录
  - 统一日志文件存放到`logs/`目录
  - 创建`test/`目录用于测试程序和结果
  - 更新`.gitignore`规则，优化版本控制

- **Cursor规则配置**：
  - 创建项目上下文规则文件
  - 定义编码标准和开发规范
  - 配置AI助手行为和偏好
  - 提升开发效率和代码质量

### 性能提升
- WebSocket连接稳定性显著提升，支持页面刷新自动重连
- 输出格式转换性能优化，转换过程几乎无感知
- 项目文件组织更加清晰，便于维护和扩展
- AI助手代码生成质量提升，更符合项目规范

### 用户体验改进
- 页面刷新后WebSocket连接自动恢复，无需手动重连
- 所有输出格式自动转换为简体中文，提升文件可读性
- 项目结构更加清晰，便于新开发者理解
- 开发工具配置完善，提升开发体验

### 测试验证
- 通过WebSocket连接测试验证修复效果
- 验证所有输出格式的简体中文转换功能
- 确认文件组织结构优化效果
- 测试Cursor规则文件的配置效果

### 文档更新
- 创建`docs/WEBSOCKET_FIX_SUMMARY.md`：WebSocket修复详细说明
- 创建`docs/SIMPLIFIED_CHINESE_OUTPUT_SUMMARY.md`：简体中文转换功能说明
- 创建`docs/PROJECT_RULES.md`：项目规则文件
- 创建`test/README.md`：测试目录说明
- 创建`.cursor/rules/`：Cursor规则文件

---

## v0.0.7 (2025-08-22)

### 重要修复
- **修复GPU显存池死锁问题**：解决任务卡在pending状态无法处理的关键bug
- **优化显存分配机制**：修复available_memory属性的递归锁问题
- **增强系统启动验证**：确保调度器正确启动并运行
- **完善错误处理机制**：添加系统启动失败时的优雅退出
- **修复批量任务调度循环问题**：解决多任务处理时的显存分配循环bug
- **完善转录结果列表框自动刷新**：确保转录完成后前端自动更新结果列表

### 问题解决
- 修复`available_memory`属性调用`free_memory`导致的死锁
- 修复`allocate`方法中调用`available_memory`时的锁冲突
- 修复`release`方法中的递归锁问题
- 解决任务调度器无法正常处理待处理任务的问题
- 修复批量任务调度中显存不足时的循环释放问题
- 优化前端异步刷新机制，确保转录结果及时显示

### 技术改进
- 重构GPU显存池的锁管理机制，避免递归锁
- 优化显存分配和释放的并发安全性
- 增强main.py中的系统启动验证逻辑
- 完善调度器状态检查和错误处理
- 改进批量任务调度逻辑，支持单个任务执行
- 增强前端文件列表刷新机制，添加调试日志和错误处理

### 性能提升
- 显存分配响应时间从卡死状态恢复到正常（<1秒）
- 任务调度效率显著提升，无卡顿现象
- 系统稳定性大幅改善，支持连续任务处理
- 多任务并发处理能力显著提升
- 前端响应速度优化，转录结果实时更新

### 测试验证
- 通过基础GPU显存池测试验证修复效果
- 确认转录任务完整流程正常工作
- 验证显存分配、任务处理、结果保存全流程正常
- 成功测试4个文件并发转录，无循环问题
- 验证转录结果列表框自动刷新功能正常工作

---

## v0.0.6 (2025-08-20)

### 新增功能
- 完善日志系统，实现重要信息同时发送到index运行日志、log文件、WebSocket和终端
- 优化日志记录机制，支持多目标日志输出
- 增强系统监控和调试能力

### 改进
- 统一日志记录接口，提高日志管理效率
- 完善前端日志显示功能
- 优化WebSocket日志推送机制

### 技术改进
- 更新logger.py，增强多目标日志处理能力
- 完善前端statusLogger.js，改进日志显示和推送功能
- 优化各核心模块的日志记录实现

---

## v0.0.5 (2025-08-15)

### 新增功能
- 集成NVIDIA ML库获取精确GPU信息
- 实现显存预估池机制，支持预估→实测→调整的闭环管理
- 添加显存占用上限控制，确保使用不超过总显存的90%
- 支持多GPU并发处理，提高系统整体效率
- 实现GPU任务调度算法，优化资源分配

### 改进
- 重构GPU管理器，增强显存监控能力
- 优化显存分配逻辑，提高资源利用率
- 改进任务队列管理，支持优先级调度
- 完善显存校准机制，提高预估准确性

### 配置变更
- 新增MAX_TASKS_PER_GPU配置项，限制单GPU并发任务数
- 新增MEMORY_CONFIDENCE_FACTOR配置项，用于显存预估置信因子（默认1.0）
- 新增CALIBRATION_SAMPLE_SIZE配置项，控制校准样本数量
- 调整RESERVED_MEMORY默认值为0.0GB

### 新增配置参数详解
#### MEMORY_CONFIDENCE_FACTOR
- **作用**：显存校准置信因子，用于动态调整模型显存预估的准确性
- **默认值**：1.0
- **推荐范围**：0.8-1.5
- **计算公式**：最终显存需求 = 基础显存预估 × 时长因子 × MEMORY_CONFIDENCE_FACTOR
- **配置位置**：config.py 第134行，支持环境变量覆盖
- **使用场景**：
  - 生产环境：1.0（平衡安全性和效率）
  - 高负载环境：1.2（增加安全边际）
  - 测试环境：0.9（提高资源利用率）
  - 资源受限环境：0.8（最大化利用率）

### 技术改进
- 更新gpu_manager.py，集成pynvml库
- 完善memory_manager.py，实现显存预估池机制
- 优化optimized_whisper.py，支持多GPU任务调度
- 更新config.py，添加新的显存管理配置项

---

## v0.0.4 (2025-08-14)

### 新增功能
- 添加 turbo 模型支持，平衡速度和精度
- 新增 FFmpeg 系统依赖安装指南
- 支持多操作系统 FFmpeg 安装说明（openEuler、Ubuntu、Debian、Arch Linux、macOS、Windows）
- 完善模型内存需求显示功能

### 改进
- 修复模型内存需求显示为"--"的问题
- 更新所有模型的显存需求配置
- 完善前端模型选择器的内存需求映射
- 优化 README 文档，添加详细的环境配置说明
- 设置 turbo 为默认推荐模型

### 技术改进
- 更新 main.py 中的 WHISPER_MODELS 列表
- 完善 gpuMonitor.js 和 uiManager.js 中的模型内存需求配置
- 同步更新 .env 和 .env.sample 配置文件
- 更新相关文档（MEMORY_CALCULATION_GUIDE.md、USAGE_INSTRUCTIONS.md）

---

## v0.0.3 (2025-01-XX)

### 新增功能
- 添加模型下载进度提示弹窗
- 实现实时下载进度显示
- 支持模型下载状态监控
- 增加WebSocket进度推送功能

### 改进
- 调整弹窗样式和大小，与播放器保持一致
- 优化模型存储路径配置
- 修复模型下载路径问题
- 完善进度捕获和显示机制

### 配置变更
- 更新MODEL_BASE_PATH为/opt/models/openai
- 修正模型下载目录结构为whisper-{模型名称}
- 优化模型路径管理逻辑

---

## v0.0.2 (2025-01-XX)

### 新增功能
- 增加 Markdown 解析模块
- 支持版本历史显示
- 优化音频播放器界面
- 添加浮动播放器文件名显示

### 改进
- 重构音频播放器实现
- 移除重复代码
- 提升用户体验

---

## v0.0.1 (2025-08-13)

### 项目描述
改进版Whisper音频转录系统，支持多文件上传和自动选择功能

### 主要功能
- 支持多文件同时上传
- 自动选择上传的文件
- 支持10种常用语言转录
- GPU加速转录
- 实时任务监控

### 改进内容
- 优化文件管理器实现
- 增强多文件处理能力
- 改进用户界面交互
- 完善转录语言限制